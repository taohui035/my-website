<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Taozhiruo.com | 创意空间</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Taozhiruo 的个人网站：创意、技术、数据可视化与生活灵感。" />
  <!-- OpenGraph / Twitter -->
  <meta property="og:title" content="Taozhiruo | 创意空间" />
  <meta property="og:description" content="探索我的数字世界：项目、设计与AI应用作品集。" />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="zh_CN" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- 性能优化：预连接字体域名 -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&family=Noto+Sans+SC:wght@300;400;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary-hex: #00bcd4;
      --primary-rgb: 0, 188, 212;
      --secondary-hex: #ff4081;
      --secondary-rgb: 255, 64, 129;
      --text-color-light: #ecf0f1;
      --bg-dark: #0f1b27;
      --glass-bg: rgba(255, 255, 255, 0.08);
      --glass-border: rgba(255, 255, 255, 0.1);
    }

    .skip-link { position: absolute; left: -9999px; top: auto; width: 1px; height: 1px; overflow: hidden; }
    .skip-link:focus { left: 16px; top: 16px; width: auto; height: auto; background: #000; color: #fff; padding: 8px 12px; border-radius: 8px; z-index: 9999; }

    html { scroll-behavior: smooth; }

    body {
      margin: 0; padding: 0;
      font-family: 'Noto Sans SC', 'Montserrat', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text-color-light);
      background-color: var(--bg-dark);
      overflow-x: hidden;
    }

    header, main, footer { display: block; }

    .video-background { position: fixed; inset: 0; overflow: hidden; z-index: -1; }
    .video-background video { min-width: 100%; min-height: 100%; width: auto; height: auto; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); object-fit: cover; filter: brightness(0.6); }

    .video-overlay { position: fixed; inset: 0; background: linear-gradient(135deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.5) 100%); z-index: -1; }

    /* 首屏与区块高度：减少留白，增强连贯 */
    .hero-section { min-height: 72vh; padding: 80px 20px 0; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; position: relative; }
    .content-section { min-height: 88vh; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 80px 20px; text-align: center; position: relative; }

    .hero-section h1 { font-family: 'Montserrat', sans-serif; font-size: clamp(2.4rem, 6vw, 4.5rem); margin: 0 0 20px; background: linear-gradient(45deg, var(--primary-hex), var(--secondary-hex)); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700; }
    .hero-section p { font-size: clamp(1rem, 2.5vw, 1.5rem); max-width: 800px; margin: 0 0 40px; font-weight: 300; }

    .scroll-down { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); animation: bounce 2s infinite; }

    /* 英雄区和项目区之间的波浪过渡 */
    .section-bridge { position: absolute; bottom: -1px; left: 0; width: 100%; height: 120px; pointer-events: none; }
    .section-bridge svg { display: block; width: 100%; height: 100%; }

    .glass-card { background: var(--glass-bg); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border: 1px solid var(--glass-border); border-radius: 16px; padding: 40px; margin: 20px auto; box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37); max-width: 1000px; width: min(1000px, 92%); opacity: 0; transform: translateY(50px); transition: opacity 0.8s ease-out, transform 0.8s ease-out; }
    .glass-card.fade-in { opacity: 1; transform: translateY(0); }
    .glass-card h2 { color: var(--primary-hex); font-size: clamp(1.6rem, 3.5vw, 2.5rem); margin: 0 0 20px; text-align: center; }
    .glass-card p { font-size: 1.1em; line-height: 1.7; margin: 0 0 15px; }

    .interactive-button { display: inline-block; background-color: var(--primary-hex); color: #ffffff; padding: 12px 30px; text-decoration: none; border-radius: 50px; transition: background-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease; border: none; cursor: pointer; font-size: 1.05em; font-weight: 700; margin-top: 20px; box-shadow: 0 4px 15px rgba(var(--primary-rgb), 0.35); }
    .interactive-button:hover { background-color: var(--secondary-hex); transform: translateY(-3px); box-shadow: 0 6px 20px rgba(var(--secondary-rgb), 0.5); }

    .image-gallery { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 30px; }
    .gallery-item { position: relative; overflow: hidden; border-radius: 10px; }
    .gallery-item img { width: 100%; height: 200px; object-fit: cover; display: block; transition: transform 0.5s ease; }
    .gallery-item:hover img { transform: scale(1.05); }

    /* 作品集轮播 */
    .carousel { position: relative; width: 100%; max-width: 920px; margin: 30px auto 0; overflow: hidden; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
    .carousel-track { display: flex; transition: transform 0.5s ease-in-out; will-change: transform; }
    .carousel-slide { min-width: 100%; position: relative; }
    .carousel-caption { position: absolute; inset: auto 0 0 0; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); padding: 40px 20px 20px; color: #fff; text-align: left; }
    .carousel-caption h3 { margin: 0 0 5px; font-size: clamp(1.1rem, 2.5vw, 1.5rem); font-family: 'Montserrat', sans-serif; }
    .carousel-caption p { margin: 0; font-size: 1em; color: rgba(255,255,255,0.85); }
    .carousel-nav { position: absolute; top: 50%; transform: translateY(-50%); width: 100%; display: flex; justify-content: space-between; pointer-events: none; }
    .carousel-button { pointer-events: all; background-color: rgba(0,0,0,0.35); border: none; color: #fff; font-size: 2em; cursor: pointer; padding: 10px 15px; border-radius: 50%; margin: 0 20px; transition: background-color 0.3s; }
    .carousel-button:hover { background-color: rgba(0,0,0,0.6); }
    .carousel-dots { position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px; }
    .carousel-dot { width: 12px; height: 12px; border-radius: 50%; background-color: rgba(255,255,255,0.45); border: 0; cursor: pointer; }
    .carousel-dot[aria-selected="true"], .carousel-dot.active { background-color: #fff; }

    /* 动画容器（替代图片） */
    .carousel-ani { width: 100%; height: 52vh; max-height: 560px; min-height: 280px; }
    @media (max-width: 768px) { .carousel-ani { height: 42vh; } }

    /* 社交图标按钮 */
    .social-icons { display: flex; flex-wrap: wrap; justify-content: center; gap: 14px; margin-top: 10px; }
    .social-btn { width: 52px; height: 52px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; background: var(--glass-bg); border: 1px solid var(--glass-border); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); text-decoration: none; color: #fff; transition: transform .25s ease, box-shadow .25s ease, background .25s ease; }
    .social-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 22px rgba(0,0,0,.35); background: linear-gradient(135deg, rgba(var(--primary-rgb),.25), rgba(var(--secondary-rgb),.25)); }
    .social-btn svg { width: 22px; height: 22px; stroke: currentColor; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }

    @keyframes bounce { 0%, 20%, 50%, 80%, 100% { transform: translateY(0) translateX(-50%); } 40% { transform: translateY(-10px) translateX(-50%); } 60% { transform: translateY(-5px) translateX(-50%); } }

    /* 尊重用户减少动态偏好 */
    @media (prefers-reduced-motion: reduce) { * { animation-duration: 0.001ms !important; animation-iteration-count: 1 !important; transition-duration: 0.001ms !important; scroll-behavior: auto !important; } .scroll-down { animation: none; } }
  
    /* ===== 额外美观与时尚交互增强 ===== */
    /* 主题切换按钮 */
    .theme-toggle { position: fixed; right: 18px; top: 18px; z-index: 20; width: 44px; height: 44px; border-radius: 50%; border: 1px solid var(--glass-border); background: var(--glass-bg); color: #fff; display: inline-flex; align-items: center; justify-content: center; cursor: pointer; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); box-shadow: 0 8px 22px rgba(0,0,0,.25); transition: transform .25s ease, box-shadow .25s ease, background .25s ease; }
    .theme-toggle:hover { transform: translateY(-2px); box-shadow: 0 10px 26px rgba(0,0,0,.35); background: linear-gradient(135deg, rgba(var(--primary-rgb),.25), rgba(var(--secondary-rgb),.25)); }
    .theme-toggle svg { width: 20px; height: 20px; stroke: currentColor; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }

    /* 主题：浅色模式覆盖 */
    body.theme-light { color: #111; background: #f7f9fc; }
    body.theme-light .video-overlay { background: linear-gradient(135deg, rgba(255,255,255,0.65), rgba(255,255,255,0.35)); }
    body.theme-light .glass-card { background: rgba(255,255,255,0.65); border-color: rgba(0,0,0,0.06); box-shadow: 0 8px 32px rgba(0,0,0,.07); }
    body.theme-light .carousel-button { background-color: rgba(0,0,0,0.15); color: #111; }
    body.theme-light .carousel-caption { color: #111; background: linear-gradient(to top, rgba(255,255,255,0.85), transparent); }

    /* Hero 标题渐变慢速流动 */
    .hero-section h1 { background-size: 200% 200%; animation: gradientShift 12s ease infinite; }
    @keyframes gradientShift { 0%{ background-position: 0% 50%; } 50%{ background-position: 100% 50%; } 100%{ background-position: 0% 50%; } }

    /* 轮播进度条 */
    .carousel-progress { position: absolute; left: 16px; right: 16px; bottom: 14px; height: 3px; background: rgba(255,255,255,.18); border-radius: 2px; overflow: hidden; pointer-events: none; }
    .carousel-progress .progress-bar { width: 0%; height: 100%; background: linear-gradient(90deg, var(--primary-hex), var(--secondary-hex)); border-radius: 2px; }

    /* 磁性悬停（按钮/图标） */
    .magnetic { position: relative; will-change: transform; transition: transform .15s ease; }

    /* 品牌悬停色（低饱和，时尚感） */
    .social-btn[data-brand="github"]:hover { color: #b2becd; }
    .social-btn[data-brand="linkedin"]:hover { color: #0a66c2; }
    .social-btn[data-brand="x"]:hover { color: #ccc; }
    .social-btn[data-brand="dribbble"]:hover { color: #ea4c89; }
    .social-btn[data-brand="instagram"]:hover { color: #c13584; }

  </style>
</head>
<body>
  <a class="skip-link" href="#main">跳到主要内容</a>

  <!-- 背景视频（提供 poster 与媒体查询） -->
  <div class="video-background" aria-hidden="true">
    <video autoplay muted loop playsinline poster="background_poster.jpg">
      <source src="background_video.mp4" type="video/mp4" />
      您的浏览器不支持视频背景。
    </video>
  </div>
  <div class="video-overlay" aria-hidden="true"></div>

  <header class="hero-section" role="banner">
    <h1>探索我的数字世界</h1>
    <p>欢迎来到我的个人网站，这里是我分享创意、技术和生活感悟的专属空间。</p>
    <a href="#about" class="interactive-button">了解更多</a>
    <div class="scroll-down" aria-hidden="true">↓ <span>滚动查看内容</span></div>
    <div class="section-bridge" aria-hidden="true">
      <svg viewBox="0 0 1440 120" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M0,24 C180,72 360,72 540,48 C720,24 900,-8 1080,8 C1260,24 1440,72 1440,72 L1440,120 L0,120 Z" fill="rgba(255,255,255,0.06)"/>
        <path d="M0,48 C200,88 400,92 600,68 C820,42 980,10 1200,36 C1320,50 1440,72 1440,72 L1440,120 L0,120 Z" fill="rgba(255,255,255,0.04)"/>
      </svg>
    </div>
    <button class="theme-toggle" id="themeToggle" aria-label="切换主题" title="切换主题">
    <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3v2m0 14v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/><circle cx="12" cy="12" r="4"/></svg>
  </button>
  <div class="section-bridge" aria-hidden="true">
    <svg viewBox="0 0 1440 120" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M0,24 C180,72 360,72 540,48 C720,24 900,-8 1080,8 C1260,24 1440,72 1440,72 L1440,120 L0,120 Z" fill="rgba(255,255,255,0.06)"/>
      <path d="M0,48 C200,88 400,92 600,68 C820,42 980,10 1200,36 C1320,50 1440,72 1440,72 L1440,120 L0,120 Z" fill="rgba(255,255,255,0.04)"/>
    </svg>
  </div>
</header>

  <main id="main">
    <section id="about" class="content-section" aria-labelledby="about-title">
      <div class="glass-card">
        <h2 id="about-title">关于我</h2>
        <p>你好！我是 Taozhiruo，一位充满好奇心的探索者。我热爱技术创新，喜欢将想法付诸实践...</p>
        <div class="image-gallery">
          <!-- 图片懒加载与解码优化 -->
          <div class="gallery-item"><img loading="lazy" decoding="async" src="https://images.pexels.com/photos/3861969/pexels-photo-3861969.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" alt="科技创意" /></div>
          <div class="gallery-item"><img loading="lazy" decoding="async" src="https://images.pexels.com/photos/325185/pexels-photo-325185.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" alt="未来设计" /></div>
          <div class="gallery-item"><img loading="lazy" decoding="async" src="https://images.pexels.com/photos/1779487/pexels-photo-1779487.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" alt="编程世界" /></div>
          <div class="gallery-item"><img loading="lazy" decoding="async" src="https://images.pexels.com/photos/347141/pexels-photo-347141.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" alt="数字艺术" /></div>
        </div>
      </div>
    </section>

    <section id="projects" class="content-section" aria-labelledby="projects-title">
      <div class="glass-card">
        <h2 id="projects-title">我的项目</h2>
        <p>从网页开发到数据分析，每一个项目都凝聚了我的热情与思考。以下是我部分作品概念展示：</p>

        <!-- 轮播：加入可访问性语义与键盘交互 -->
        <div class="carousel" role="region" aria-roledescription="carousel" aria-label="作品集轮播">
  <div class="carousel-track" role="group" aria-live="polite"></div>
  <div class="carousel-nav" aria-hidden="false">
    <button class="carousel-button carousel-button-prev" aria-label="上一张" type="button" title="上一张">&lt;</button>
    <button class="carousel-button carousel-button-next" aria-label="下一张" type="button" title="下一张">&gt;</button>
  </div>
  <div class="carousel-dots" role="tablist" aria-label="轮播分页点"></div>
  <div class="carousel-progress" aria-hidden="true"><div class="progress-bar"></div></div>
</div>
<div class="carousel-nav" aria-hidden="false">
            <button class="carousel-button carousel-button-prev" aria-label="上一张" type="button" title="上一张">&lt;</button>
            <button class="carousel-button carousel-button-next" aria-label="下一张" type="button" title="下一张">&gt;</button>
          </div>
          <div class="carousel-dots" role="tablist" aria-label="轮播分页点"></div>
        </div>

      </div>
    </section>

    <section id="contact" class="content-section" aria-labelledby="contact-title">
      <div class="glass-card">
        <h2 id="contact-title">联系我</h2>
        <p>如果你对我的项目感兴趣，或者想进行技术交流，欢迎随时与我联系。</p>
        <div class="social-icons" aria-label="社交链接">
  <a class="social-btn magnetic" data-brand="github" href="https://github.com/yourname" target="_blank" rel="noopener" title="GitHub" aria-label="GitHub">
    <svg viewBox="0 0 24 24"><path d="M9 19c-4 1.5-4-2.5-6-3m12 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 18 3.77 5.07 5.07 0 0 0 17.91 1S16.73.65 14 2.48a13.38 13.38 0 0 0-10 0C1.27.65.09 1 .09 1A5.07 5.07 0 0 0 0 3.77 5.44 5.44 0 0 0 1.5 8.5c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 7 19.13V23"/></svg>
  </a>
  <a class="social-btn magnetic" data-brand="linkedin" href="https://www.linkedin.com/in/yourname" target="_blank" rel="noopener" title="LinkedIn" aria-label="LinkedIn">
    <svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M8 11v6"/><path d="M8 7h.01"/><path d="M12 17v-3a3 3 0 0 1 6 0v3"/></svg>
  </a>
  <a class="social-btn magnetic" data-brand="x" href="https://x.com/yourname" target="_blank" rel="noopener" title="X / Twitter" aria-label="X / Twitter">
    <svg viewBox="0 0 24 24"><path d="M4 4l16 16M20 4L4 20"/></svg>
  </a>
  <a class="social-btn magnetic" data-brand="dribbble" href="https://dribbble.com/yourname" target="_blank" rel="noopener" title="Dribbble" aria-label="Dribbble">
    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/><path d="M3 12h18"/><path d="M12 3a15 15 0 0 1 6.5 12.5"/><path d="M12 21a15 15 0 0 0-6.5-12.5"/></svg>
  </a>
  <a class="social-btn magnetic" data-brand="instagram" href="https://instagram.com/yourname" target="_blank" rel="noopener" title="Instagram" aria-label="Instagram">
    <svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="5"/><circle cx="12" cy="12" r="4"/><circle cx="17.5" cy="6.5" r="1"/></svg>
  </a>
  <a class="social-btn magnetic" href="mailto:taohui029@gmail.com" title="Email" aria-label="Email">
    <svg viewBox="0 0 24 24"><path d="M4 6h16a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z"/><path d="M22 8l-10 6L2 8"/></svg>
  </a>
</div>
      </div>
    </section>
  </main>

  <footer class="content-section" aria-label="页脚">
    <div class="glass-card" role="contentinfo">
      <p>© <span id="year"></span> Taozhiruo. 保留所有权利。</p>
    </div>
  </footer>

  <!-- 动态加载 Lottie：带双 CDN 回退与就绪检测，避免 ReferenceError: lottie is not defined -->
  <script>
    function loadScript(src) { return new Promise((resolve, reject) => { const s = document.createElement('script'); s.src = src; s.async = true; s.defer = true; s.crossOrigin = 'anonymous'; s.onload = () => resolve(); s.onerror = () => reject(new Error('Failed to load ' + src)); document.head.appendChild(s); }); }
    async function ensureLottie() {
      if (window.lottie) return window.lottie;
      try { await loadScript('https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js'); } catch (_) {}
      if (window.lottie) return window.lottie;
      try { await loadScript('https://unpkg.com/lottie-web@5.12.2/build/player/lottie.min.js'); } catch (_) {}
      if (!window.lottie) throw new Error('Lottie 未能加载');
      return window.lottie;
    }
  </script>

  <script>
    (async function init() {
      // 年份自动更新
      document.getElementById('year').textContent = new Date().getFullYear();

      // ===== 主题切换：跟随系统 + 手动覆盖 =====
      const prefersLight = window.matchMedia('(prefers-color-scheme: light)');
      const savedTheme = localStorage.getItem('pref-theme');
      function applyTheme(theme) { document.body.classList.toggle('theme-light', theme === 'light'); }
      function currentSystemTheme() { return prefersLight.matches ? 'light' : 'dark'; }
      applyTheme(savedTheme || currentSystemTheme());
      document.getElementById('themeToggle').addEventListener('click', () => {
        const next = document.body.classList.contains('theme-light') ? 'dark' : 'light';
        applyTheme(next); localStorage.setItem('pref-theme', next);
      });
      prefersLight.addEventListener('change', e => { if (!localStorage.getItem('pref-theme')) applyTheme(e.matches ? 'light' : 'dark'); });

      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      // 轮播数据（替换为你的动画 json 路径）
      const slidesData = [
        { src: 'animations/uiux.json', title: 'UI/UX 设计', desc: '专注于创造美观、直观且用户友好的数字体验。' },
        { src: 'animations/dataviz.json', title: '数据可视化', desc: '将复杂数据转化为富有洞察力的交互式图表。' },
        { src: 'animations/ai.json', title: '人工智能应用', desc: '探索机器学习与 AI 在现实世界中的创新应用。' },
        { src: 'animations/mobile.json', title: '移动应用开发', desc: '构建流畅、高性能的 iOS 与 Android 原生应用。' },
        { src: 'animations/architecture.json', title: '未来建筑概念', desc: '融合科技与艺术，探索可持续的未来生活空间。' }
      ];

      // 渲染轮播 DOM
      const track = document.querySelector('.carousel-track');
      const dotsNav = document.querySelector('.carousel-dots');
      const prevButton = document.querySelector('.carousel-button-prev');
      const nextButton = document.querySelector('.carousel-button-next');
      const progressBar = document.querySelector('.carousel-progress .progress-bar');
      const carouselEl = document.querySelector('.carousel');

      slidesData.forEach((s, idx) => {
        const slide = document.createElement('div');
        slide.className = 'carousel-slide';
        slide.setAttribute('role', 'group');
        slide.setAttribute('aria-roledescription', 'slide');
        slide.setAttribute('aria-label', `${idx + 1} / ${slidesData.length}`);
        slide.innerHTML = `
          <div class=\"carousel-ani\" data-src=\"${s.src}\"></div>
          <div class=\"carousel-caption\"><h3>${s.title}</h3><p>${s.desc}</p></div>
        `;
        track.appendChild(slide);

        const dot = document.createElement('button');
        dot.className = 'carousel-dot';
        dot.setAttribute('role', 'tab');
        dot.setAttribute('aria-label', `第 ${idx + 1} 张`);
        dot.setAttribute('aria-selected', idx === 0 ? 'true' : 'false');
        dot.addEventListener('click', () => moveToSlide(idx, { user: true }));
        dotsNav.appendChild(dot);
      });

      const slides = Array.from(track.children);
      const dots = Array.from(dotsNav.children);

      // —— 确认 lottie 存在后再初始化 ——
      let players = [];
      try {
        const l = await ensureLottie();
        players = slides.map((slide, i) => {
          const container = slide.querySelector('.carousel-ani');
          return l.loadAnimation({ container, renderer: 'svg', loop: true, autoplay: !prefersReduced && i === 0, path: container.dataset.src });
        });
      } catch (err) {
        console.warn('[Lottie] 未加载，已启用无动画降级：', err.message);
        slides.forEach(slide => { const box = slide.querySelector('.carousel-ani'); box.style.background = 'linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.02))'; });
      }

      let slideWidth = slides[0]?.getBoundingClientRect().width || 0;
      let currentIndex = 0;
      let autoPlayInterval = null;
      const AUTO_MS = 4000;
      let isDragging = false, startX = 0, startTx = 0, deltaX = 0;

      function layout() {
        slideWidth = slides[0]?.getBoundingClientRect().width || 0;
        slides.forEach((slide, i) => { slide.style.left = (slideWidth * i) + 'px'; });
        moveToSlide(currentIndex, { instant: true, skipAnim: true });
      }

      function updateDots(nextIdx) {
        dots.forEach((d, i) => d.setAttribute('aria-selected', i === nextIdx ? 'true' : 'false'));
        dots.forEach((d, i) => d.classList.toggle('active', i === nextIdx));
      }

      function startProgress() {
        if (!progressBar) return; // 安全
        progressBar.style.transition = 'none';
        progressBar.style.width = '0%';
        requestAnimationFrame(() => {
          // 下一帧开始线性增长
          progressBar.style.transition = `width ${AUTO_MS}ms linear`;
          progressBar.style.width = '100%';
        });
      }

      function resetProgress() {
        if (!progressBar) return;
        progressBar.style.transition = 'none';
        progressBar.style.width = '0%';
      }

      function moveToSlide(targetIndex, opts = {}) {
        const { instant = false, skipAnim = false } = opts;
        if (!slides.length) return;
        const tx = -(slideWidth * targetIndex);
        if (instant) {
          track.style.transition = 'none';
          track.style.transform = `translateX(${tx}px)`;
          void track.offsetHeight; // 强制回流
          track.style.transition = '';
        } else {
          track.style.transform = `translateX(${tx}px)`;
        }
        if (!prefersReduced && !skipAnim) {
          players[currentIndex]?.pause?.();
          players[targetIndex]?.play?.();
        }
        updateDots(targetIndex);
        currentIndex = targetIndex;
        resetProgress(); startProgress();
      }

      function next() { moveToSlide((currentIndex + 1) % slides.length); }
      function prev() { moveToSlide((currentIndex - 1 + slides.length) % slides.length); }

      // 点击按钮
      nextButton.addEventListener('click', () => { next(); resetInterval(); });
      prevButton.addEventListener('click', () => { prev(); resetInterval(); });

      // 键盘支持
      carouselEl.addEventListener('keydown', (e) => { if (e.key === 'ArrowRight') { next(); resetInterval(); } if (e.key === 'ArrowLeft') { prev(); resetInterval(); } });

      // 触控/鼠标拖拽滑动
      function onDown(e) { isDragging = true; startX = e.clientX || e.touches?.[0]?.clientX || 0; startTx = -(slideWidth * currentIndex); deltaX = 0; track.style.transition = 'none'; carouselEl.setPointerCapture?.(e.pointerId || 1); }
      function onMove(e) { if (!isDragging) return; const x = e.clientX || e.touches?.[0]?.clientX || 0; deltaX = x - startX; track.style.transform = `translateX(${startTx + deltaX}px)`; }
      function onUp() { if (!isDragging) return; isDragging = false; track.style.transition = ''; const threshold = Math.min(80, slideWidth * 0.18); if (Math.abs(deltaX) > threshold) { deltaX < 0 ? next() : prev(); } else { moveToSlide(currentIndex, { instant: false, skipAnim: true }); } resetInterval(); }

      carouselEl.addEventListener('pointerdown', onDown); window.addEventListener('pointermove', onMove); window.addEventListener('pointerup', onUp); carouselEl.addEventListener('touchstart', onDown, { passive: true }); window.addEventListener('touchmove', onMove, { passive: true }); window.addEventListener('touchend', onUp, { passive: true });
      carouselEl.addEventListener('dragstart', e => e.preventDefault());

      // 自动播放
      function startInterval() { if (prefersReduced) return; stopInterval(); startProgress(); autoPlayInterval = setInterval(() => next(), AUTO_MS); }
      function stopInterval() { if (autoPlayInterval) { clearInterval(autoPlayInterval); autoPlayInterval = null; } resetProgress(); }
      function resetInterval() { stopInterval(); startInterval(); }

      // 可见性与视口检测
      document.addEventListener('visibilitychange', () => { document.hidden ? stopInterval() : startInterval(); });
      const io = new IntersectionObserver(entries => { entries.forEach(entry => { if (entry.isIntersecting) startInterval(); else stopInterval(); }); }, { threshold: 0.4 });
      io.observe(carouselEl);

      // 磁性悬停（轻微跟随）
      function attachMagnetic(el) {
        el.addEventListener('mousemove', (e) => { const r = el.getBoundingClientRect(); const x = (e.clientX - (r.left + r.width/2)) / (r.width/2); const y = (e.clientY - (r.top + r.height/2)) / (r.height/2); el.style.transform = `translate3d(${x*6}px, ${y*6}px, 0)`; });
        el.addEventListener('mouseleave', () => { el.style.transform = 'translate3d(0,0,0)'; });
      }
      document.querySelectorAll('.magnetic, .interactive-button').forEach(attachMagnetic);

      // 初始布局
      const resizeObserver = new ResizeObserver(() => layout());
      resizeObserver.observe(carouselEl);
      window.addEventListener('orientationchange', layout);
      window.addEventListener('resize', layout);
      layout();

      // —— 自检（扩展测试用例）——
      console.groupCollapsed('%c自检(Self-Tests)', 'color:#00bcd4');
      console.assert(!!document.querySelector('.carousel'), '应存在轮播容器 .carousel');
      console.assert(Array.isArray(slidesData) && slidesData.length > 0, 'slidesData 应包含至少 1 项');
      console.assert(document.querySelectorAll('.carousel-ani').length === slidesData.length, '已渲染与 slidesData 等量的动画容器');
      console.assert(!!document.getElementById('themeToggle'), '主题切换按钮存在');
      console.assert(['light','dark'].includes(localStorage.getItem('pref-theme')||'dark') || true, '主题首选项可读取');
      console.assert(!!document.querySelector('.carousel-progress .progress-bar'), '进度条存在');
      if (window.lottie) {
        console.assert(players.length === slidesData.length, '已实例化与 slidesData 等量的 Lottie 播放器');
        console.assert(typeof players[0]?.play === 'function', '播放器应具有 play 方法');
      } else {
        console.warn('Lottie 不可用：处于无动画降级模式');
      }
      console.groupEnd();
    })();
  </script>
</body>
</html>
